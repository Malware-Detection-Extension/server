// ğŸ“„ ëŒ€ìƒ í™•ì¥ì: .rtf
// ğŸ§© ëŒ€ìƒ í”„ë¡œê·¸ë¨: Microsoft Word, WordPad ë“±
// ğŸ¯ íƒì§€ ëª©ì : RTF ë¬¸ì„œ ë‚´ OLE ê°œì²´, ì‰˜ì½”ë“œ, ì·¨ì•½ì  ê³µê²© íŒ¨í„´ íƒì§€

rule RTF_Embedded_OLE_Object
{
    meta:
        description = "RTF ë¬¸ì„œ ë‚´ OLE ê°œì²´ ì‚½ì… íƒì§€ ({\\object, {\\objdata})"
        author = "Seo"
        severity = "high"
        category = "document"

    strings:
        $header = "{\\rtf" ascii
        $obj1 = "{\\object" ascii nocase
        $obj2 = "{\\objdata" ascii nocase
        $class = "objclass" ascii nocase
        $exe = ".exe" ascii nocase

    condition:
        $header at 0 and (2 of ($obj*, $class, $exe))
}

rule RTF_Nop_Sled_Heuristic
{
    meta:
        description = "RTF ë¬¸ì„œ ë‚´ NOP sled ê¸°ë°˜ ì‰˜ì½”ë“œ ì¡´ì¬ ê°€ëŠ¥ì„± íƒì§€"
        author = "Seo"
        severity = "medium"
        category = "document"

    strings:
        $header = "{\\rtf" ascii
        $nop = { 90 90 90 90 90 90 90 90 90 90 }  // ê¸´ NOP sled
        $jmp = { E9 ?? ?? ?? ?? }                // jmp instruction
        $call = { E8 ?? ?? ?? ?? }               // call instruction

    condition:
        $header at 0 and (1 of ($nop, $jmp, $call))
}

rule RTF_Exploit_CVE_2017_11882
{
    meta:
        description = "CVE-2017-11882 EQNEDT32 ì·¨ì•½ì  ì‹œë„ íƒì§€"
        author = "Seo"
        severity = "high"
        category = "document"

    strings:
        $eqn = "EQNEDT32.EXE" ascii nocase
        $obj = "{\\object" ascii
        $oledata = "{\\*\\objdata" ascii

    condition:
        all of them
}

rule RTF_Suspicious_Shell_Strings
{
    meta:
        description = "RTF ë‚´ ì™¸ë¶€ ì‹¤í–‰ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì˜ì‹¬ ë¬¸ìì—´ íƒì§€"
        author = "Seo"
        severity = "medium"
        category = "document"

    strings:
        $cmd = "cmd.exe" ascii nocase
        $ps = "powershell" ascii nocase
        $url = /http[s]?:\/\/[^\s]+/ ascii
        $dll = ".dll" ascii nocase
        $bat = ".bat" ascii nocase

    condition:
        2 of them
}
